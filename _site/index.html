<!DOCTYPE html>
<html lang="es-ES">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Micro‚ÄÜFrontends - Extendiendo la idea de microservicio al desarrollo frontend</title>
    <meta name="description" content="Extendiendo la idea de microservicios al desarrollo frontend. T√©cnicas, estrategias y recetas para construir una aplicacion moderna con multiples equipos que entregan funcionalidades independientemente.">
    <meta name="viewport" content="width=device-width">
    <link rel="canonical" href="https://micro-frontends.org/" />
    <link rel="alternate" hreflang="ja" href="https://micro-frontends-japanese.org/" />
    <link rel="alternate" hreflang="es" href="https://micro-frontends-es.org/" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://micro-frontends-es.org/" />
    <meta property="og:image" content="/ressources/screen/three-teams.png" />
    <meta property="og:site_name" content="Micro Frontends" />
    <meta property="og:description" content="Techniques, strategies and recipes for building a modern web app with multiple teams using different JavaScript frameworks." />
    <link href='https://fonts.googleapis.com/css?family=Handlee&font-display=swap' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/assets/css/style.css?v=17624e8e603108fb2efa3ed3c9225c138f36e264" media="screen" type="text/css">
    <link rel="stylesheet" href="/assets/css/print.css" media="print" type="text/css">
  </head>

  <body>
    <header>
      <div class="inner">
        <a href="http://localhost:4000/">
          <h1>Micro‚ÄÜFrontends</h1>
        </a>
        <h2>Extendiendo la idea de microservicio al desarrollo frontend</h2>
        
          <a href="https://github.com/mijaresorlando/micro-frontends" class="button"><small>View project on</small> GitHub</a>
        
        
        <div class="languages">
          <a href="https://micro-frontends.org/">EN</a>
          <a href="https://micro-frontends-japanese.org/">JP</a>
          <strong>ES</strong>
        </div>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <p>T√©cnicas, estrategias y recetas para crear una <strong>aplicaci√≥n web moderna</strong> con <strong>m√∫ltiples equipos</strong> que pueden <strong>entregar funcionalidades independientemente</strong>.</p>

<h2 id="qu√©-son-los-micro-frontend">¬øQu√© son los micro frontend?</h2>

<p>El t√©rmino <strong>Micro Frontends</strong> apareci√≥ por primera vez en <a href="https://www.thoughtworks.com/radar/techniques/micro-frontends">ThoughtWorks Technology Radar</a> a finales de 2016. Extiende los conceptos de los micro servicios al mundo del frontend. La tendencia actual es crear una aplicaci√≥n de navegador potente y rica en caracter√≠sticas, tambi√©n conocida como ‚Äúsingle page app‚Äù, que se asiente sobre una arquitectura de microservicio. Con el tiempo, la capa de frontend, a menudo desarrollada por un equipo independiente, crece y se vuelve m√°s dif√≠cil de mantener. Eso es lo que llamamos una <a href="https://www.youtube.com/watch?v=pU1gXA0rfwc">Interfaz Monol√≠tica</a>.</p>

<p>La idea detr√°s de Micro Frontends es pensar en un sitio web o aplicaci√≥n web como <strong>una composici√≥n de caracter√≠sticas</strong> que son propiedad de <strong>equipos independientes</strong>. Cada equipo tiene un <strong>√°rea de negocio definida</strong> o <strong>misi√≥n</strong> de la que se preocupa y se especializa. Un equipo es <strong>cross functional</strong> y desarrolla sus caracter√≠sticas <strong>end-to-end</strong>, desde la base de datos hasta la interfaz de usuario.</p>

<p>Sin embargo, esta idea no es nueva, en el pasado se llamaba <a href="https://dev.otto.de/2014/07/29/scaling-with-microservices-and-vertical-decomposition/">Integraci√≥n de Frontend para Sistemas Verticales</a> o <a href="http://scs-architecture.org/">Sistemas autocontenidos</a>. Pero Micro Frontends es claramente un t√©rmino m√°s amigable y menos voluminoso.</p>

<p><strong>Frontends monol√≠ticos</strong>
<img src="/ressources/diagrams/organisational/monolith-frontback-microservices.png" alt="Fases monol√≠ticas" /></p>

<p><strong>Organizaci√≥n vertical</strong>
<img src="/ressources/diagrams/organisational/verticals-headline.png" alt="Equipos de extremo a extremo con Micro Frontends" /></p>

<h2 id="qu√©-es-una-aplicaci√≥n-web-moderna">¬øQu√© es una aplicaci√≥n web moderna?</h2>

<p>En la introducci√≥n he usado la frase ‚Äúcrear una aplicaci√≥n web moderna‚Äù. Vamos a definir los supuestos que est√°n relacionados con este t√©rmino.</p>

<p>Para poner esto en una perspectiva m√°s amplia, <a href="https://ar.al/">Aral Balkan</a> ha escrito una publicaci√≥n en su blog sobre lo que √©l llama el <a href="https://ar.al/notes/the-documents-to-applications-continuum/">Documents‚Äêto‚ÄêApplications Continuum</a>. Sugiere la idea de una escala m√≥vil en la que un sitio, construido a partir de <strong>documentos est√°ticos</strong>, conectado a trav√©s de enlaces, se encuentra <strong>a la izquierda</strong> y uno dirigido completamente por comportamiento, una <strong>aplicaci√≥n sin contenido</strong>, como un editor de fotos en online, est√° <strong>a la derecha</strong>.</p>

<p>Si tu proyecto se encuentra en el <strong>lado izquierdo de este espectro</strong>, una <strong>integraci√≥n en servidor web</strong> es una buena opci√≥n. Con este modelo, un servidor recopila y <strong>concatena cadenas de HTML</strong> de todos los componentes que conforman la p√°gina solicitada por el usuario. Las actualizaciones se realizan recargando la p√°gina desde el servidor o reemplazando partes de ella a trav√©s de ajax. <a href="https://twitter.com/gustaf_nk/">Gustaf Nilsson Kotte</a> ha escrito un <a href="https://gustafnk.github.io/microservice-websites/">amplio art√≠culo</a> sobre este tema.</p>

<p>Cuando la interfaz de usuario tiene que proporcionar <strong>informaci√≥n instant√°nea</strong>, incluso en conexiones no estables, un sitio de servidor puro no es suficiente. Para implementar t√©cnicas como <a href="https://www.smashingmagazine.com/2016/11/true-lies-of-optimistic-user-interfaces/">UI optimista</a> o <a href="http://www.lukew.com/ff/entry.asp?1797">Skeleton Screens</a> debe poder tambi√©n <strong>actualizar</strong> la UI <strong>en el dispositivo en s√≠</strong>. El t√©rmino de Google <a href="https://developers.google.com/web/progressive-web-apps/">Progressive Web Apps</a> describe adecuadamente el <strong>balanceo</strong> entre ser un buen ciudadano de la web (mejora progresiva) y al mismo tiempo proporcionar rendimiento como en una app. Este tipo de aplicaci√≥n se encuentra en alg√∫n lugar <strong>sobre la mitad</strong>. Aqu√≠ una soluci√≥n basada √∫nicamente en el servidor ya no es suficiente. Tenemos que movernos a la integraci√≥n <strong>en el navegador</strong>, y ese es el enfoque de este art√≠culo.</p>

<h2 id="ideas-centrales-detr√°s-de-las-micro-frontend">Ideas centrales detr√°s de las micro frontend</h2>

<ul>
  <li><strong>S√© Agn√≥stico a la Tecnolog√≠a</strong><br />Cada equipo debe poder elegir y actualizar su stack sin tener que coordinar con otros equipos. Los <a href="#el-dom-es-la-api">Custom Elements</a> son una excelente manera de ocultar los detalles de la implementaci√≥n mientras se proporciona una interfaz neutral a otros.</li>
  <li><strong>Aislar el c√≥digo del equipo</strong><br /> No compartir tiempo de ejecuci√≥n, incluso si todos los equipos usan el mismo framework. Crea aplicaciones independientes que sean aut√≥nomas. No hay que confiar en estado compartido o variables globales.</li>
  <li><strong>Establecer prefijos de equipo</strong><br />Acordar los espacios de nombres no aislados. Espacio de nombres CSS, eventos, almacenamiento local y cookies para evitar colisiones y dejar clara la propiedad.</li>
  <li><strong>Favorece las funciones nativas del navegador sobre las API personalizadas</strong><br />Utilizar <a href="#comunicaci√≥n-padre-hijo--modificaci√≥n-de-dom">Eventos de navegador para la comunicaci√≥n</a> en lugar de crear un sistema global PubSub. Si realmente tiene que crear una API de varios equipos, intente que sea lo m√°s simple posible.</li>
  <li><strong>Construir un sitio resiliente</strong><br />Su funci√≥n deber√≠a ser √∫til, incluso si JavaScript falla o no se ha ejecutado todav√≠a. Utilizar <a href="#renderizad-en-servidor--renderizado-universal">Universal Rendering</a> y Progressive Enhancement para mejorar el rendimiento percibido.</li>
</ul>

<hr />

<h2 id="el-dom-es-la-api">El DOM es la API</h2>

<p><a href="https://developers.google.com/web/fundamentals/getting-started/primers/customelements">Custom Elements</a>, el aspecto de interoperabilidad de las especificaciones de Web Components, son una buena primitiva para la integraci√≥n en el navegador. Cada equipo construye su componente <strong>usando la tecnolog√≠a web de su elecci√≥n</strong> y <strong>lo envuelve dentro de un Custom Element</strong> (por ejemplo, <code class="highlighter-rouge">&lt;order-minicart&gt;&lt;/order-minicart&gt;</code>). La especificaci√≥n DOM de este elemento en particular (nombre de etiqueta, atributos y eventos) act√∫a como el contrato o API p√∫blica para otros equipos. La ventaja es que pueden usar el componente y su funcionalidad sin tener que conocer la implementaci√≥n. Solo tienen que ser capaces de interactuar con el DOM.</p>

<p>Pero los custom elements por s√≠ solos no son la soluci√≥n a todas nuestras necesidades. Para abordar la mejora progresiva, renderizado universal o el routing, necesitamos piezas de software adicionales.</p>

<p>Esta p√°gina est√° dividida en dos √°reas principales. Primero, analizaremos <a href="#composici√≥n-de-la-p√°gina">Composici√≥n de la p√°gina</a>: c√≥mo ensamblar una p√°gina con componentes que pertenecen a diferentes equipos. Despu√©s mostraremos ejemplos para implementar el lado de cliente <a href="#page-transition">Transici√≥n de p√°gina</a>.</p>

<h2 id="composici√≥n-de-la-p√°gina">Composici√≥n de la p√°gina</h2>

<p>Adem√°s de la integraci√≥n <strong>cliente-servidor</strong> del c√≥digo escrito con <strong>diferentes frameworks</strong>, hay muchos temas secundarios que deben ser discutidos: mecanismos para <strong>aislar js</strong>, <strong>evitar conflictos css</strong>, <strong>cargar recursos</strong> seg√∫n sea necesario, <strong>compartir recursos comunes</strong> entre equipos, manejar la <strong>obtenci√≥n de datos</strong> y pensar sobre <strong>estados de carga</strong> buenos para el usuario. Vamos a entrar en estos temas paso a paso.</p>

<h3 id="el-prototipo-base">El prototipo base</h3>

<p>La p√°gina de productos de este modelo de tienda de tractores servir√° de base para los siguientes ejemplos.</p>

<p>Cuenta con un <strong>selector</strong> para cambiar entre los tres modelos diferentes de tractores. Al cambiar la imagen del producto, se actualizan el nombre, el precio y las recomendaciones. Tambi√©n hay un <strong>bot√≥n comprar</strong>, que a√±ade la variedad seleccionada a la cesta y una <strong>minicesta</strong> en la parte superior que se actualiza en consecuencia.</p>

<p><a href="./0-model-store/"><img src="/ressources/video/model-store-0.gif" alt="Examplo 0 - P√°gina del producto - Plain JS" /></a></p>

<p><a href="./0-model-store/">probar en navegador</a> &amp; <a href="https://github.com/neuland/micro-frontends/tree/master/0-model-store">inspeccionar c√≥digo</a></p>

<p>Todo el HTML se genera en el lado del cliente utilizando <strong>JavaScript</strong> y Template Strings ES6 <strong>sin dependencias</strong>. El c√≥digo separa estado de maquetacion y vuelve a renderizar todo el lado del cliente HTML en cada cambio, sin DOM extra√±o ni <strong>renderizado universal</strong> por ahora. Tampoco <strong>separaci√≥n por equipo</strong> - [c√≥digo] https://github.com/neuland/micro-frontends/tree/master/0-model-store) est√° escrito en un archivo js/css.</p>

<h3 id="integraci√≥n-del-lado-del-cliente">Integraci√≥n del lado del cliente</h3>

<p>En este ejemplo, la p√°gina se divide en componentes/fragmentos separados que pertenecen a tres equipos. <strong>Team Checkout</strong> (azul) ahora es responsable de todo lo relacionado con el proceso de compra, es decir, <strong>bot√≥n de compra</strong> y <strong>minicesta</strong>. <strong>Team Inspire</strong> (verde) administra las <strong>recomendaciones de producto</strong> en esta p√°gina. La p√°gina en s√≠ es propiedad de <strong>Team Product</strong> (rojo).</p>

<p><a href="./1-composition-client-only/"><img src="/ressources/screen/three-teams.png" alt="Ejemplo 1 - P√°gina del producto - Composici√≥n" /></a></p>

<p><a href="./1-composition-client-only/">probar en navegador</a> &amp; <a href="https://github.com/neuland/micro-frontends/tree/master/1-composition-client-only">inspeccionar c√≥digo</a></p>

<p><strong>El equipo de producto</strong>(rojo) decide qu√© funcionalidad se incluye y d√≥nde se coloca en el dise√±o. La p√°gina contiene informaci√≥n que puede ser proporcionada por el propio equipo, como el nombre del producto, la imagen y las variedades disponibles. Pero tambi√©n incluye fragmentos (custom elements) de los otros equipos.</p>

<h3 id="c√≥mo-crear-un-custom-element">¬øC√≥mo crear un Custom Element?</h3>

<p>Tomemos el <strong>bot√≥n de compra</strong> como ejemplo. El equipo de producto incluye el bot√≥n simplemente agregando <code class="highlighter-rouge">&lt;blue-buy sku="t_porsche"&gt;&lt;/blue-buy&gt;</code> en la posici√≥n deseada en la maquetaci√≥n. Para que esto funcione, Team Checkout debe registrar el elemento <code class="highlighter-rouge">blue-buy</code> en la p√°gina.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class BlueBuy extends HTMLElement {
  constructor() {
    super();
    this.innerHTML = `&lt;button type="button"&gt;buy for 66,00 ‚Ç¨&lt;/button&gt;`;
  }
  disconnectedCallback() { ... }
}
window.customElements.define('blue-buy', BlueBuy);
</code></pre></div></div>

<p>Ahora, cada vez que el navegador encuentra una nueva etiqueta <code class="highlighter-rouge">blue-buy</code>, se llama al constructor. <code class="highlighter-rouge">this</code> es la referencia al nodo DOM ra√≠z del Custom Element. Se pueden usar todas las propiedades y m√©todos de un elemento DOM est√°ndar como <code class="highlighter-rouge">innerHTML</code> o <code class="highlighter-rouge">getAttribute()</code>.</p>

<p><img src="/ressources/video/custom-element.gif" alt="Custom Elements en acci√≥n" /></p>

<p>Al nombrar tu elemento, el √∫nico requisito que define la especificaci√≥n es que el nombre debe <strong>incluir un gui√≥n (-)</strong> para mantener la compatibilidad con las nuevas etiquetas HTML. En los siguientes ejemplos, se utiliza la convenci√≥n de nombres <code class="highlighter-rouge">[color]-[caracter√≠stica]</code>. El espacio de nombres del equipo protege contra las colisiones y, de esta manera, el propietario de una caracter√≠stica se vuelve obvio, simplemente mirando el DOM.</p>

<h3 id="comunicaci√≥n-padre-hijo--modificaci√≥n-de-dom">Comunicaci√≥n padre-hijo / Modificaci√≥n de DOM</h3>

<p>Cuando el usuario selecciona otro tractor en el <strong>selector</strong>, el <strong>bot√≥n comprar debe actualizarse</strong> en consecuencia. Para lograr el equipo de producto simplemente puede <strong>borrar</strong> el elemento existente del DOM <strong>e insertar</strong> uno nuevo.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>container.innerHTML;
// =&gt; &lt;blue-buy sku="t_porsche"&gt;...&lt;/blue-buy&gt;
container.innerHTML = '&lt;blue-buy sku="t_fendt"&gt;&lt;/blue-buy&gt;';
</code></pre></div></div>

<p>El <code class="highlighter-rouge">disconnectedCallback</code> del antiguo elemento se invoca de forma sincr√≥nica para proporcionar al elemento la posibilidad de limpiar cosas como los event listeners. Despu√©s de eso, se llama al <code class="highlighter-rouge">constructor</code> del elemento<code class="highlighter-rouge"> t_fendt</code> reci√©n creado.</p>

<p>Otra opci√≥n m√°s eficaz es simplemente actualizar el atributo <code class="highlighter-rouge">sku</code> en el elemento existente.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>document.querySelector('blue-buy').setAttribute('sku', 't_fendt');
</code></pre></div></div>

<p>Si el equipo de producto usara un motor de plantillas que detecta diferencias de DOM, como React, el algoritmo lo har√≠a autom√°ticamente.</p>

<p><img src="/ressources/video/custom-element-attribute.gif" alt="Cambio de atributo de Custom Element" /></p>

<p>Para respaldar esto, el Custom Element puede implementar <code class="highlighter-rouge">attributeChangedCallback</code> y especificar una lista de atributos observados en <code class="highlighter-rouge">observedAttributes</code> para los cuales se debe ejecutar este callback.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const prices = {
  t_porsche: '66,00 ‚Ç¨',
  t_fendt: '54,00 ‚Ç¨',
  t_eicher: '58,00 ‚Ç¨',
};

class BlueBuy extends HTMLElement {
  static get observedAttributes() {
    return ['sku'];
  }
  constructor() {
    super();
    this.render();
  }
  render() {
    const sku = this.getAttribute('sku');
    const price = prices[sku];
    this.innerHTML = `&lt;button type="button"&gt;buy for ${price}&lt;/button&gt;`;
  }
  attributeChangedCallback(attr, oldValue, newValue) {
    this.render();
  }
  disconnectedCallback() {...}
}
window.customElements.define('blue-buy', BlueBuy);
</code></pre></div></div>

<p>Para evitar la duplicidad, se introduce un m√©todo <code class="highlighter-rouge">render()</code> que se llama desde <code class="highlighter-rouge">constructor</code> y<code class="highlighter-rouge"> attributeChangedCallback</code>. Este m√©todo recopila los datos necesarios y el nuevo html que se asigna a innerHTML. Si se decide ir con un motor de plantillas o un framework m√°s sofisticado dentro del custom element, aqu√≠ es donde va la inializaci√≥n de este.</p>

<h3 id="soporte-en-navegador">Soporte en navegador</h3>

<p>El ejemplo anterior utiliza la especificaci√≥n Custom Element V1 que actualmente est√° <a href="http://caniuse.com/#feat=custom-elementsv1">soportada en Chrome, Safari y Opera</a>. Pero con <a href="https://github.com/WebReflection/document-register-element">document-register-element</a> hay disponible un polyfill ligero y probado en la batalla para que  funcione en todos los navegadores. Bajo el cap√≥, utiliza la API de Mutation Observer <a href="http://caniuse.com/#feat=mutationobserver">ampliamente soportada</a>, por lo que no hay operaciones raras en √°rbol del DOM en segundo plano.</p>

<h3 id="framework-de-compatibilidad">Framework de Compatibilidad</h3>

<p>Debido a que los custom elements son un est√°ndar web, todos los frameworks principales de JavaScript como Angular, React, Preact, Vue o Hyperapp los soportan. Pero cuando entras en detalle, todav√≠a hay algunos problemas de implementaci√≥n en algunos frameworks. En <a href="https://custom-elements-everywhere.com/">Custom Elements Everywhere</a> <a href="https://twitter.com/rob_dodson">Rob Dodson</a> ha reunido un conjunto de pruebas de compatibilidad que destaca los problemas no resueltos.</p>

<h3 id="comunicaci√≥n-padre-hijo-o-hermanos--eventos-de-dom">Comunicaci√≥n padre-hijo (o hermanos) / eventos de DOM</h3>

<p>Pero pasar atributos no es suficiente para todas las interacciones. En nuestro ejemplo, la <strong>minicesta debe actualizarse</strong> cuando el usuario hace <strong>click en el bot√≥n comprar</strong>.</p>

<p>Ambos fragmentos son propiedad de Team Checkout (azul), por lo que podr√≠an crear alg√∫n tipo de API interna de JavaScript que le permita a la mini cesta saber cu√°ndo se presion√≥ el bot√≥n. Pero esto requerir√≠a que las instancias de los componentes se conozcan entre s√≠ y tambi√©n ser√≠a una violaci√≥n de aislamiento.</p>

<p>Una forma m√°s limpia es utilizar un mecanismo PubSub, donde un componente puede publicar un mensaje y otros componentes pueden suscribirse a temas espec√≠ficos. Por suerte los navegadores tienen esta caracter√≠stica incorporada. As√≠ es exactamente c√≥mo funcionan los eventos del navegador como <code class="highlighter-rouge">click</code>,<code class="highlighter-rouge"> select</code> o <code class="highlighter-rouge">mouseover</code>. Adem√°s de los eventos nativos, tambi√©n existe la posibilidad de crear eventos de nivel superior con <code class="highlighter-rouge">new CustomEvent(...)</code>. Los eventos siempre est√°n vinculados al nodo DOM en el que se crearon/enviaron. La mayor√≠a de los eventos nativos tambi√©n hacen bubbling. Esto hace posible escuchar todos los eventos en un sub√°rbol espec√≠fico del DOM. Si desea escuchar todos los eventos de la p√°gina, se puede a√±adir un listener al elemento window. Aqu√≠ es c√≥mo se ve la creaci√≥n del evento <code class="highlighter-rouge">blue:basket:changed</code> en el ejemplo:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class BlueBuy extends HTMLElement {
  [...]
  connectedCallback() {
    [...]
    this.render();
    this.firstChild.addEventListener('click', this.addToCart);
  }
  addToCart() {
    // maybe talk to an api
    this.dispatchEvent(new CustomEvent('blue:basket:changed', {
      bubbles: true,
    }));
  }
  render() {
    this.innerHTML = `&lt;button type="button"&gt;buy&lt;/button&gt;`;
  }
  disconnectedCallback() {
    this.firstChild.removeEventListener('click', this.addToCart);
  }
}
</code></pre></div></div>

<p>La mini cesta ahora puede suscribirse a este evento en <code class="highlighter-rouge">window</code> y recibir una notificaci√≥n cuando deba actualizar sus datos.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class BlueBasket extends HTMLElement {
  connectedCallback() {
    [...]
    window.addEventListener('blue:basket:changed', this.refresh);
  }
  refresh() {
    // fetch new data and render it
  }
  disconnectedCallback() {
    window.removeEventListener('blue:basket:changed', this.refresh);
  }
}
</code></pre></div></div>

<p>Con este enfoque el fragmento de la mini cesta agrega un oyente a un elemento DOM que est√° fuera de su alcance (<code class="highlighter-rouge">window</code>). Esto deber√≠a estar bien para muchas aplicaciones, pero si no estas c√≥modo con esto, tambi√©n se puede implementar un enfoque en el que la propia p√°gina (Team Product) escuche el evento y notifique a la mini cesta llamando a <code class="highlighter-rouge">refresh()</code> en el elemento DOM.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// page.js
const $ = document.getElementsByTagName;

$('blue-buy')[0].addEventListener('blue:basket:changed', function() {
  $('blue-basket')[0].refresh();
});
</code></pre></div></div>

<p>Llamada imperativa a los m√©todos DOM es bastante poco com√∫n, pero se puede encontrar en <a href="https://developer.mozilla.org/de/docs/Web/HTML/Using_HTML5_audio_and_video#Controlling_media_playback">video element api</a> por ejemplo. Si es posible se deber√≠a hacer uso de un enfoque declarativo (cambio de atributo).</p>

<h2 id="renderizado-en-servidor--renderizado-universal">Renderizado en servidor / Renderizado Universal</h2>

<p>Los Custom Elements son excelentes para integrar componentes dentro del navegador. Pero cuando se construye un site, es probable que la velocidad de carga inicial sea importante y que los usuarios vean una pantalla en blanco hasta que se descarguen y ejecuten todos los frameworks JS. Adem√°s, es bueno pensar qu√© pasa con el sitio si el JavaScript falla o est√° bloqueado. <a href="https://adactio.com/">Jeremy Keith</a> explica la importancia de su libro/podcast <a href="https://resilientwebdesign.com/">Resilient Web Design</a>. Por lo tanto, la capacidad de renderizar el contenido en el servidor es clave. Lamentablemente, la especificaci√≥n de componentes web no habla en absoluto renderizado en servidor. Sin JavaScript no hay Custom Elements :(</p>

<h3 id="custom-elements--server-side-includes--Ô∏è">Custom Elements + Server Side Includes = ‚ù§Ô∏è</h3>

<p>Para hacer que el renderizado del servidor funcione hay que refactorizar el ejemplo anterior. Cada equipo tiene su propio servidor Express y el m√©todo <code class="highlighter-rouge">render()</code> del elemento personalizado tambi√©n es accesible a trav√©s de url.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl http://127.0.0.1:3000/blue-buy?sku=t_porsche
&lt;button type="button"&gt;buy for 66,00 ‚Ç¨&lt;/button&gt;
</code></pre></div></div>

<p>El nombre de la etiqueta del Custom Element se utiliza como nombre de la ruta: los atributos se convierten en query params. Ahora hay una manera de procesar en servidor el contenido de cada componente. Combinado con custom element <code class="highlighter-rouge">&lt;blue-buy&gt;</code> se consigue algo que est√° bastante cerca de un <strong>Universal Web Component</strong>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;blue-buy sku="t_porsche"&gt;
  &lt;!--#include virtual="/blue-buy?sku=t_porsche" --&gt;
&lt;/blue-buy&gt;
</code></pre></div></div>

<p>El comentario <code class="highlighter-rouge">#include</code> es parte de <a href="https://en.wikipedia.org/wiki/Server_Side_Includes">Server Side Includes</a>, que es una caracter√≠stica que est√° disponible en la mayor√≠a de los servidores web. S√≠, es la misma t√©cnica usada hace tiempo para insertar la fecha actual en nuestros sitios web. Tambi√©n hay algunas t√©cnicas alternativas como <a href="https://en.wikipedia.org/wiki/Edge_Side_Includes">ESI</a>, <a href="https://github.com/Schibsted-Tech-Polska/nodesi">nodesi</a>, <a href="https://github.com/tes/compoxure">compoxure</a> y <a href="https://github.com/zalando/tailor">tailor</a>, pero en general Server Side Iincludes (SSI) ha demostrado ser una soluci√≥n simple e incre√≠blemente estable.</p>

<p>El comentario <code class="highlighter-rouge">#include</code> se reemplaza con la respuesta de <code class="highlighter-rouge">/blue-buy?sku=t_porsche</code> antes de que el servidor web env√≠e la p√°gina completa al navegador. La configuraci√≥n en nginx ser√≠a as√≠:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>upstream team_blue {
  server team_blue:3001;
}
upstream team_green {
  server team_green:3002;
}
upstream team_red {
  server team_red:3003;
}

server {
  listen 3000;
  ssi on;

  location /blue {
    proxy_pass  http://team_blue;
  }
  location /green {
    proxy_pass  http://team_green;
  }
  location /red {
    proxy_pass  http://team_red;
  }
  location / {
    proxy_pass  http://team_red;
  }
}
</code></pre></div></div>

<p>La directiva <code class="highlighter-rouge">ssi: on;</code> habilita la funci√≥n SSI y a√±adimos un bloque <code class="highlighter-rouge">upstream</code> y <code class="highlighter-rouge">location</code> para cada equipo para garantizar que todas las direcciones URL que comienzan con <code class="highlighter-rouge">/blue</code> se dirijan a la aplicaci√≥n correcta (<code class="highlighter-rouge">team_blue: 3001</code>). Adem√°s, la ruta <code class="highlighter-rouge">/</code> se asigna al equipo rojo, que controla la p√°gina de inicio / p√°gina de producto.</p>

<p>Esta animaci√≥n muestra la tienda de tractores en un navegador que tiene <strong>JavaScript desactivado</strong>.</p>

<p><a href="./ressources/video/server-render.mp4"><img src="/ressources/video/server-render.gif" alt="Serverside Rendering - Disabled JavaScript" /></a></p>

<p><a href="https://github.com/neuland/micro-frontends/tree/master/2-composition-universal">ver el c√≥digo</a></p>

<p>Los botones de selecci√≥n ahora son enlaces reales y cada click produce una recarga de la p√°gina. El terminal a la derecha ilustra el proceso de c√≥mo una solicitud de una p√°gina se enruta al equipo rojo, que controla la p√°gina de producto y luego el marcado se complementa con los fragmentos del equipo azul y verde.</p>

<p>Al volver a activar JavaScript, solo estar√°n visibles los mensajes llamadas al servidor para la primera solicitud. Todos los cambios posteriores se manejan del lado del cliente, como en el primer ejemplo. En un ejemplo posterior, los datos del producto se extraer√°n del JavaScript y se cargar√°n a trav√©s de una API REST seg√∫n sea necesario.</p>

<p>Puedes jugar con este c√≥digo de muestra en tu m√°quina local. Solo se debe instalar <a href="https://docs.docker.com/compose/install/">Docker Compose</a>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/neuland/micro-frontends.git
cd micro-frontends/2-composition-universal
docker-compose up --build
</code></pre></div></div>

<p>Docker luego inicia el nginx en el puerto 3000 y construye la imagen node.js para cada equipo. Cuando se abra <a href="http://127.0.0.1:3000/">http://127.0.0.1:3000/</a> en el navegador se debe de ver un tractor rojo. El log combinado de <code class="highlighter-rouge">docker-compose</code> hace que sea f√°cil ver lo que est√° sucediendo en la red. Lamentablemente, no hay forma de controlar el color de salida, por lo que el equipo azul se resaltar√° en verde :)</p>

<p>Los archivos <code class="highlighter-rouge">src</code> se mapean a contenedores individuales y la aplicaci√≥n node se reinicia cuando realiza un cambio de c√≥digo. Cambiar el <code class="highlighter-rouge">nginx.conf</code> requiere un reinicio de <code class="highlighter-rouge">docker-compose</code> para que tenga efecto. As√≠ que no dudes en juguetear y dar tu opini√≥n.</p>

<h3 id="carga-de-datos-y-estados-carga">Carga de datos y Estados carga</h3>

<p>Una desventaja del enfoque SSI/ESI es que el fragmento <strong>m√°s lento determina el tiempo de respuesta</strong> de toda la p√°gina.
As√≠ que es bueno almacenar los framentos en cach√©.
Para los fragmentos que son costosos de producir y dif√≠ciles de almacenar en cach√©, a menudo es buena idea excluirlos del procesamiento inicial.
Se pueden cargar de forma as√≠ncrona en el navegador.
En nuestro ejemplo, el fragmento <code class="highlighter-rouge">green-recos</code>, que muestra recomendaciones personalizadas, es un candidato para esto.</p>

<p>Una posible soluci√≥n ser√≠a que el equipo rojo solo omita el SSI Include.</p>

<p><strong>Antes</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;green-recos sku="t_porsche"&gt;
  &lt;!--#include virtual="/green-recos?sku=t_porsche" --&gt;
&lt;/green-recos&gt;
</code></pre></div></div>

<p><strong>Despu√©s</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;green-recos sku="t_porsche"&gt;&lt;/green-recos&gt;
</code></pre></div></div>

<p><em>Nota importante: Custom Elements <a href="https://developers.google.com/web/fundamentals/architecture/building-components/customelements#jsapi">no puede cerrarse en un solo tag</a>, por lo que <code class="highlighter-rouge">&lt;green-recos sku="t_porsche" /&gt;</code> no funciona correctamente.</em></p>

<p><img alt="Reflow" src="./ressources/video/data-fetching-reflow.gif" style="width: 500px" /></p>

<p>El renderizado solo tiene lugar en el navegador.
Pero, como se puede ver en la animaci√≥n, este cambio ahora ha introducido un <strong>reflow importante</strong> de la p√°gina.
El √°rea de recomendaci√≥n est√° inicialmente en blanco.
El JavaScript del equipo verde est√° cargado y ejecutado.
Se hace la llamada al API para obtener la recomendaci√≥n personalizada.
El HTML de la recomendaci√≥n se renderiza y se solicitan las im√°genes asociadas.
El fragmento ahora necesita m√°s espacio y empuja el dise√±o de la p√°gina.</p>

<p>Hay diferentes opciones para evitar un reflow molesto como √©ste.
El equipo rojo, que controla la p√°gina, podr√≠a <strong>fijar la altura de los contenedores de recomendaci√≥n</strong>.
En un sitio web responsive a menudo es dif√≠cil determinar la altura, ya que podr√≠a diferir para diferentes tama√±os de pantalla.
Pero el problema m√°s importante es que <strong>este tipo de acuerdo entre equipos crea un fuerte acoplamiento</strong> entre el equipo rojo y verde.
Si el equipo verde quiere introducir un subt√≠tulo adicional en el elemento reco, tendr√≠a que coordinar con el equipo rojo en la nueva altura.
Ambos equipos tendr√≠an que implementar sus cambios simult√°neamente para evitar romper dise√±o.</p>

<p>Una mejor manera es usar una t√©cnica llamada <a href="https://blog.prototypr.io/luke-wroblewski-introduced-skeleton-screens-in-2013-through-his-work-on-the-polar-app-later-fd1d32a6a8e7">Skeleton Screens</a>.
El equipo rojo deja el <code class="highlighter-rouge">green-recos</code> SSI Include en la maquetaci√≥n.
Adem√°s, el equipo verde cambia el <strong>m√©todo de render en el servidor</strong> de su fragmento para que produzca una <strong>versi√≥n esquem√°tica del contenido</strong>.
El <strong>skeleton markup</strong> puede reutilizar partes de los estilos de dise√±o del contenido real.
De esta manera, <strong>reserva el espacio necesario</strong> y el relleno del contenido real no produce salto.</p>

<p><img alt="Skeleton Screen" src="./ressources/video/data-fetching-skeleton.gif" style="width: 500px" /></p>

<p>Los <strong>skeleton</strong> tambi√©n son <strong>muy √∫tiles para la representaci√≥n del cliente</strong>.
Cuando un custom element se inserta en el DOM por una acci√≥n del usuario, puede <strong>instant√°neamente representar skeleton</strong> hasta que lleguen los datos que necesita del servidor.</p>

<p>Incluso en un <strong>cambio de atributo</strong> como <em>variant select</em> se puede decidir mostrar el skeleton hasta que lleguen los nuevos datos.
De esta manera, el usuario percibe que algo est√° sucediendo en el fragmento.
Pero cuando el endpoint responde r√°pidamente, un breve <strong>skeleton flicker</strong> entre los datos antiguos y nuevos tambi√©n podr√≠a ser molesto.
Preservar los datos antiguos o usar timeouts inteligentes puede ayudar.
Utiliza esta t√©cnica con cuidado y recoger feedback de los usuarios.</p>

<h2 id="navegando-entre-p√°ginas">Navegando entre p√°ginas</h2>

<p><strong>Continuar√° ‚Ä¶</strong></p>

<p>Puede ver el <a href="https://github.com/neuland/micro-frontends">Repo en Github</a> para m√°s informaci√≥n.</p>

<h2 id="recursos-adicionales">Recursos adicionales</h2>
<ul>
  <li><a href="https://www.youtube.com/watch?v=dTW7eJsIHDg">Charla: Micro Frontends - Web Rebels, Oslo 2018</a> (<a href="https://noti.st/naltatis/HxcUfZ/micro-frontends-think-smaller-avoid-the-monolith-love-the-backend">Slides</a>)</li>
  <li><a href="https://speakerdeck.com/naltatis/micro-frontends-building-a-modern-webapp-with-multiple-teams">Slides: Micro Frontends - JSUnconf.eu 2017</a></li>
  <li><a href="https://www.youtube.com/watch?v=W3_8sxUurzA">Charla: Break Up With Your Frontend Monolith - JS Kongress 2017</a> Elisabeth Engel habla sobre implementacion de Micro Frontends en gutefrage.net</li>
  <li><a href="https://medium.com/@tomsoderlund/micro-frontends-a-microservice-approach-to-front-end-web-development-f325ebdadc16">Post: Micro frontends - a microservice approach to front-end web development</a> Tom S√∂derlund explica el concepto y provee enlaces sobre este tema.</li>
  <li><a href="http://www.agilechamps.com/microservices-to-micro-frontends/">Post: Microservices to Micro-Frontends</a> Sandeep Jain resume los pricipios clave detr√°s de los microservicios y micro frontends</li>
  <li><a href="https://micro-frontends.zeef.com/elisabeth.engel?ref=elisabeth.engel&amp;share=ee53d51a914b4951ae5c94ece97642fc">Link Collection: Micro Frontends by Elisabeth Engel</a> extensa lista de posts, charlas, herramientas y otros recursos sobre este tema.</li>
  <li><a href="https://github.com/ChristianUlbrich/awesome-microfrontends">Awesome Micro Frontends</a> una lista filtrada de enlaces por Christian Ulbrich üï∂</li>
  <li><a href="https://custom-elements-everywhere.com/">Custom Elements Everywhere</a> Comprueba c√≥mo frameworks y custom elements pueden ser amigos.</li>
  <li>Los tractores se pueden comprar en <a href="https://www.manufactum.com/">manufactum.com</a> :)<br /><em>Esta tienda est√° desarrollada por dos equipos usando las t√©cnicas aqu√≠ descritas.</em></li>
</ul>

<h2 id="t√©cnicas-relacionadas">T√©cnicas relacionadas</h2>
<ul>
  <li><a href="https://paulhammant.com/categories.html#Cookie_Cutter_Scaling">Posts: Cookie Cutter Scaling</a> David Hammet escribe una serie de art√≠culos en blog sobre este tema.</li>
  <li><a href="https://en.wikipedia.org/wiki/Java_Portlet_Specification">Wikipedia: Java Portlet Specification</a> Especificaci√≥n que trata temas similares para crear portales empresariales.</li>
</ul>

<hr />

<h2 id="cosas-por-venir-">Cosas por venir ‚Ä¶</h2>

<ul>
  <li>Casos de uso
    <ul>
      <li>Navegaci√≥n entre p√°ginas
        <ul>
          <li>Navegaci√≥n suave vs navegaci√≥n dura</li>
          <li>Router universal</li>
        </ul>
      </li>
      <li>‚Ä¶</li>
    </ul>
  </li>
  <li>Temas secundarios
    <ul>
      <li>CSS aislado / Interfaz de usuario coherente / Gu√≠as de estilo y bibliotecas de patrones</li>
      <li>Rendimiento en carga inicial</li>
      <li>Rendimiento durante el uso del sitio</li>
      <li>Carga de CSS</li>
      <li>Carga de JS</li>
      <li>Tests de integraci√≥n</li>
      <li>‚Ä¶</li>
    </ul>
  </li>
</ul>

<h2 id="autor">Autor</h2>
<p><strong>Michael Geers</strong> (<a href="https://twitter.com/naltatis">@naltatis</a>) es ingeniero de software en <a href="https://www.neuland-bfi.de/">neuland B√ºro f√ºr Informatik</a> y trabaja en la construcci√≥n de frontends agradables para e-commerce.</p>

<h2 id="colaboradores">Colaboradores</h2>
<ul>
  <li><a href="https://github.com/scipion">Jorge Beltr√°n</a> colaborador traducci√≥n y correcciones a <a href="https://micro-frontends-es.org">Espa√±ol</a>.</li>
  <li><a href="https://github.com/koiketakayuki">Koike Takayuki</a> quien tradujo el sitio a <a href="https://micro-frontends-japanese.org/">Japon√©s</a>.</li>
</ul>

<p>Este sitio es generado por Github Pages. Su fuente se puede encontrar en espa√±ol en <a href="https://github.com/scipion/micro-frontends/">scipion/micro-frontends</a>, o en el sitio original en <a href="https://github.com/neuland/micro-frontends/">neuland/micro-frontends</a>.</p>

        </section>
      </div>
    </div>

    
      <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-145454462-1', 'auto');
        ga('send', 'pageview');
      </script>
    
  </body>
</html>